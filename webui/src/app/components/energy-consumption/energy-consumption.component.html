<ng4-loading-spinner> </ng4-loading-spinner>
<div class="clearfix"> </div>
<div class="content">
    <div class="row">
        <div class="col-12">
            <div class="breadcrumb-section">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Energy Consumption</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Energy Consumption</li>
                    </ol>
                </nav>
            </div>

            <!-- body-->
            <div class="clear"> </div>
            <div class="row-fluid">
                <div class="panel panel-primary">
                    <div class="panel-heading">Energy Consumption Information</div>
                    <div class="panel-body">
                        <div class="p-24">
                            <div class="col-sm-12">
                                <div class="col-md-3">
                                    <mat-radio-group aria-label="Select an option" (change)="radioChange($event)">
                                       <!--  <mat-radio-button value="1" checked (change)="radioChange($event)"
                                            style="width: 22%;">Date</mat-radio-button>
                                        <mat-radio-button value="2" (change)="radioChange($event)">Station
                                        </mat-radio-button> -->
                                        <mat-radio-button *ngFor="let op of radioList" 
                                        [checked]="op.checked" value="{{op.name}}" >{{ op.name}}</mat-radio-button>
                                    </mat-radio-group>
                                </div>
                                <div class="col-md-2">
                                    <mat-form-field fxFlex="30" class="example-full-width">
                                        <mat-select placeholder="Division" (selectionChange)="updateDivision($event)" [(ngModel)]="divisionCode">
                                            <mat-option *ngFor="let divisionsList of divisionsList"
                                                [value]="divisionsList.code">
                                                {{ divisionsList.code }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div class="col-md-3" *ngIf="exactDate">
                                    <mat-form-field>
                                        <input matInput [matDatepicker]="picker1" placeholder="Choose Date"
                                            [(ngModel)]="selectedExactDate" (dateChange)="exactDateEvent($event)">
                                        <mat-datepicker-toggle matSuffix [for]="picker1">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #picker1></mat-datepicker>
                                    </mat-form-field>
                                </div>

                                <div class="col-md-6" *ngIf="!exactDate">
                                    <div class="col-md-3">
                                        <mat-form-field fxFlex="30" class="example-full-width">
                                            <mat-select placeholder="Feeder Name"
                                                (selectionChange)="updateFeederName($event)" [(ngModel)]="feederId">
                                                <mat-option *ngFor="let feeders of feedersList"
                                                    [value]="feeders.feederId">
                                                    {{ feeders.feederName }}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-3">
                                        <mat-form-field>
                                            <input matInput [matDatepicker]="picker3" placeholder="Choose From Date"
                                                [(ngModel)]="selectedBWFrom" (dateChange)="bwFromDateEvent($event)">
                                            <mat-datepicker-toggle matSuffix [for]="picker3">
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #picker3></mat-datepicker>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-3">
                                        <mat-form-field>
                                            <input matInput [matDatepicker]="picker2" placeholder="Choose To Date"
                                                [min]="selectedBWFrom" [(ngModel)]="selectedBWTo"
                                                (dateChange)="bwToDateEvent($event)">
                                            <mat-datepicker-toggle matSuffix [for]="picker2">
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #picker2></mat-datepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button class="mat-raised-button mat-accent" color="accent" class="d-inline"
                                        mat-raised-button="" type="button" (click)="executeQuery()">
                                        Go
                                    </button>
                                </div>
                            </div>
                            <br>
                            <div class="example-header">
                                <div class="col-sm-4">
                                    <mat-form-field>
                                        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
                                    </mat-form-field>
                                </div>
                                <div class="clear"> </div>
                            </div>

                            <div class="table-sort-input example-container mat-elevation-z8 table-responsive">
                                <table mat-table [dataSource]="filterData.dataSource" matSort>

                                    <ng-container matColumnDef="sno">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header [attr.rowspan]="2">
                                            <span> Sno</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            {{row.sno}}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Feeder_Name">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>Feeder Name</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            {{row.Feeder_Name}}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Previous_Date">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>Date</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            {{row.requested_reading_date}} :
                                            {{row.Previous_Date.slice(0,row.kwh_f)}}
                                            <span style="color: red;">{{row.Previous_Date.slice(row.kwh_f,row.kwh_m)}}</span>
                                            days )
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Multification_Factor">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>MF </span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Multification_Factor}}</td>
                                    </ng-container>

                                    <ng-container matColumnDef="Joint_Reading">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>JMR </span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.joint_meter }}</td>
                                    </ng-container>

                                   <!--  <ng-container matColumnDef="CMD">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>CMD</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.CMD }}</td>
                                    </ng-container> -->

                                    <ng-container matColumnDef="Old_KWH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> KWH Old</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> 
                                            {{row.Old_KWH}}          
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Current_KWH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> KWH Current</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">{{row.Current_KWH}}</span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Current_KWH" />
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Consumption_KWH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>KWH Consumption</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Consumption_KWH}}</td>
                                    </ng-container>

                                    <ng-container matColumnDef="Old_KVAH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> KVAH Old</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Old_KVAH}}</td>
                                    </ng-container>

                                    <ng-container matColumnDef="Current_KVAH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>KVAH Current</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Current_KVAH}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Current_KVAH" />
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Consumption_KVAH">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>KVAH Consumption</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Consumption_KVAH}}</td>
                                    </ng-container>

                                    <ng-container matColumnDef="Old_RKVAH_Lag">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lag Old</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Old_RKVAH_Lag}}
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Current_RKVAH_Lag">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lag Current</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Current_RKVAH_Lag}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Current_RKVAH_Lag" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Consumption_RKVAH_Lag">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lag Consumption</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Consumption_RKVAH_Lag}}
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Old_RKVAH_Lead">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lead Old</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Old_RKVAH_Lead}}
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Current_RKVAH_Lead">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lead Current</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Current_RKVAH_Lead}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Current_RKVAH_Lead" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Consumption_RKVAH_Lead">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>RKVAH Lead Consumption</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row"> {{row.Consumption_RKVAH_Lead}}
                                        <td>
                                    </ng-container>

                                    <!-- <ng-container matColumnDef="PF">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> PF</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.PF}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.PF" />
                                        <td>
                                    </ng-container> 

                                    <ng-container matColumnDef="CPF">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> CPF</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.CPF}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.CPF" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="RMD">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> RMD</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.RMD}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.RMD" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Vol_Max">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> Vol Max</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Vol_Max}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Vol_Max" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Vol_Min">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> Vol Min</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Vol_Min}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Vol_Min" />
                                        <td>
                                    </ng-container>

                                    <ng-container matColumnDef="Max_Load">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span> Max Load</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="!row.editable">
                                                {{row.Max_Load}}
                                            </span>
                                            <input mat-input *ngIf="row.editable" type="number" decimalNumber
                                                [value]="row.Max_Load" />
                                        <td>
                                    </ng-container>-->


                                    <ng-container matColumnDef="actions">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                            <span>Actions</span>
                                        </th>
                                        <td mat-cell *matCellDef="let row">
                                            <a mat-icon-button matTooltip="Edit"
                                                *ngIf="editPermission && !row.editable">
                                                <button mat-icon-button matTooltip="Edit"
                                                    (click)="processEditAction(row.feeder_id)">
                                                    <mat-icon style="color: rgb(0, 145, 234);">edit</mat-icon>
                                                </button>
                                            </a>
                                            <a mat-icon-button matTooltip="Save" *ngIf="editPermission && row.editable">
                                                <button mat-icon-button matTooltip="Save"
                                                    (click)="processUpdateAction(row.id)">
                                                    <mat-icon style="color: rgb(0, 145, 234);">save</mat-icon>
                                                </button>
                                            </a>
                                            <a mat-icon-button matTooltip="Cancel"
                                                *ngIf="editPermission && row.editable">
                                                <button mat-icon-button matTooltip="Cancel"
                                                    (click)="processCancelAction(row)">
                                                    <mat-icon style="color: rgb(0, 145, 234);">cancel</mat-icon>
                                                </button>
                                            </a>

                                            <button mat-icon-button matTooltip="Delete" (click)="delete(row.id)"
                                                *ngIf="deletePermission && !row.editable">
                                                <mat-icon style="color: rgb(244, 67, 54);">delete</mat-icon>
                                            </button>
                                        <td>
                                    </ng-container>


                                    <!--  <ng-container matColumnDef="header-row-first-group">
                                        <th mat-header-cell *matHeaderCellDef [attr.colspan]="3">                                         
                                        </th>
                                    </ng-container>

                                    
                                     <ng-container matColumnDef="header-row-second-group">
                                        <th mat-header-cell *matHeaderCellDef [attr.colspan]="2">                                         
                                        </th>
                                    </ng-container>
                                    
                                   
                                    <ng-container matColumnDef="header-row-third-group">
                                        <th mat-header-cell *matHeaderCellDef style="text-align:center" [attr.colspan]="3"> KWH </th>
                                    </ng-container>

                                    <ng-container matColumnDef="header-row-fourth-group">
                                        <th mat-header-cell *matHeaderCellDef style="text-align:center" [attr.colspan]="3"> KVAH </th>
                                    </ng-container>

                                    <ng-container matColumnDef="header-row-fifth-group">
                                        <th mat-header-cell *matHeaderCellDef style="text-align:center" [attr.colspan]="3"> RKVAH Lag </th>
                                    </ng-container>

                                    <ng-container matColumnDef="header-row-sixth-group">
                                        <th mat-header-cell *matHeaderCellDef style="text-align:center" [attr.colspan]="3"> RKVAH Lead</th>
                                    </ng-container>

                                    <ng-container matColumnDef="header-row-seventh-group">
                                        <th mat-header-cell *matHeaderCellDef [attr.colspan]="7"> </th>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="[
                                        'header-row-first-group', 
                                        'header-row-second-group',
                                        'header-row-third-group',
                                        'header-row-fourth-group',
                                        'header-row-fifth-group',
                                        'header-row-sixth-group',
                                        'header-row-seventh-group'
                                        ]">
                                    </tr> 
 -->

                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                                    </tr>
                                </table>

                                <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>